# 🚀 Melodic 100% 자동화 로드맵 (Automation Roadmap)

사용자께서 질문하신 **"카카오뱅크 API 연동 시 100% 완성인가?"**에 대한 기술적 답변과, 진정한 **무인 자동화 시스템**을 구축하기 위해 필요한 퍼즐 조각들을 정리했습니다.

---

## 1. 현실적인 문제점 (The Reality)

### 🏦 카카오뱅크 API의 한계
- **공식 API 부재**: 카카오뱅크는 개인 계좌에 대한 입출금 알림용 공식 Open API를 제공하지 않습니다.
- **기업용 API**: 펌뱅킹 등을 이용해야 하는데, 이는 개인 개발자가 이용하기에 비용과 절차가 매우 복잡합니다.

### 🧩 "100% 완성"을 위해 부족한 것
현재 시스템(`Admin.jsx`)에는 **두 가지**가 빠져 있습니다.
1. **Real Input**: 가상 시뮬레이터가 아닌, **실제 은행 입금 내역**을 시스템에 넣어주는 연결 고리.
2. **Real Output**: 관리자가 링크를 복사해서 보내주는 것이 아닌, **시스템이 자동으로 문자를 발송**하는 기능.

---

## 2. 해결 방안: "문자/알림 파싱" 아키텍처

공식 API 대신, **스마트폰의 푸시 알림을 가로채는 방식**이 1인 개발/소규모 프로젝트의 표준입니다.

### 🔄 전체 자동화 흐름 (The Loop)

1. **[User]** 관객이 20,000원 입금.
2. **[Bank]** 카카오뱅크 입금 알림(Push/SMS)이 운영자 폰으로 도착.
3. **[Bridge App]** 운영자 폰에 설치된 **'입금 확인 앱'**이 알림 내용을 읽어옵니다.
   - *방법 A: 기존 앱 사용 (예: 'SMS to Telegram' 등 활용)*
   - *방법 B: 직접 개발 (Tasker 혹은 간단한 안드로이드 앱)*
4. **[Firebase]** 앱이 Firebase Firestore에 입금 데이터를 전송 (Webhook/API).
5. **[System]** `Admin` 로직이 입금자명 매칭 → **자동 승인(Paid)** 처리.
6. **[Cloud Function]** 승인 상태 변경을 감지하여 **SMS API(CoolSMS 등)**를 통해 관객에게 티켓 링크 발송.

---

## 3. 상세 구현 계획 (Implementation Steps)

### Phase 1: 입금 감지 (Input Automation)
카카오뱅크 API가 없으므로 다음 대안 중 하나를 선택해야 합니다.

| 방식 | 설명 | 난이도 | 비용 | 추천 |
| :--- | :--- | :--- | :--- | :--- |
| **방법 1: 폰 알림 연동** | 안드로이드 앱(Tasker 등)으로 알림을 잡아 Firebase로 쏨 | 중 | 무료 | ⭐⭐⭐ |
| **방법 2: PC 클라이언트** | PC 카카오톡 알림을 윈도우 프로그램으로 캡쳐 | 하 | 무료 | ⭐⭐ |
| **방법 3: 서드파티 서비스** | '코드에프' 등 유료 API 사용 (개인 가능 여부 확인 필요) | 상 | 유료 | ⭐ |

**추천:** 운영자 폰(안드로이드)에 **'Tasker'**나 **'IFTTT'** 같은 자동화 앱을 깔아서, 입금 문자가 오면 Firebase로 HTTP Request를 보내도록 설정하는 것이 가장 빠르고 확실합니다.

### Phase 2: 티켓 발송 (Output Automation)
현재는 링크를 '복사'만 할 수 있습니다. 자동으로 문자를 보내려면 **SMS API 연동**이 필수입니다.

- **서비스**: CoolSMS (솔라피) 등이 국내에서 가장 많이 쓰입니다. (건당 약 20원)
- **구현 위치**:
  1. **Frontend**: `Admin` 페이지가 켜져 있을 때만 발송 (서버 비용 0원, 브라우저가 켜져 있어야 함).
  2. **Backend**: Firebase Cloud Functions가 DB 변경을 감지해 발송 (서버리스, 24시간 작동).

---

## 4. 결론: 무엇을 더 개발해야 하는가?

**"카카오뱅크 API만 붙이면 끝인가요?"** -> **아니요!**
카뱅 API 대신 **"알림 리스너"**와 **"문자 발송"** 두 가지를 붙여야 진정한 100% 자동화가 됩니다.

### ✅ To-Do List for 100% Automation
- [x] **SMS 발송 모듈 추가 (Solapi 연동)**: 티켓 링크를 문자로 전송하는 기능. ✅ 완료 (프론트엔드 방식)
- [ ] **입금 알림 리스너 구축**: (안드로이드/PC) 입금 알림을 Firebase로 쏴주는 도구 세팅.
- [x] **자동 승인 로직 개선**: 부분 입금에 대한 예외 처리 (ambiguous 상태 전환) ✅ 기존 구현 완료

---

## 5. 현재 구현 상태

### ✅ 완료된 기능
1. **SMS 자동 발송**: Admin 페이지에서 예약 승인 시 자동으로 티켓 SMS 발송
2. **수동 승인 + SMS**: 수동 승인 시에도 SMS 발송 여부 선택 가능
3. **Solapi 연동**: 프론트엔드에서 직접 API 호출 (서버 비용 0원)

### 📱 MacroDroid 설정 필요
`MACRODROID_SETUP.md` 파일을 참고하여 설정하면 완전 자동화 완성!
